---
title: "Introduction to R Workshop"
output:
  html_document:
    df_print: paged
---

# Workshop Overview

## Basic R

- `dataframe`: the most common type of data structure in R. Essentially a spreadsheet where each column in the dataframe is a variable that describes the observed unit for any given row. A `tibble` is a slightly fancier dataframe used by the tidyverse.
- `?`: using the `?` operator with a function name will being up the help screen for that
- `<-`: assignment operator. Assigns a value to a variable so the variable can be used later.
- `%>%`: pipe operator. takes the output of one operation and inserts it as the input to the next operation.

## Packages

While a number of functions are available in base R, the beauty of R is that there are a huge number of publicly available, open-source packages to make your data analysis life easier. R packages are generally housed and maintained on the [CRAN](https://cran.r-project.org/) website, however a number of packages can be installed from Github and other hosting sites as well.

### Installation

The packages we will use in this workshop are `rstatix` and the `tidyverse` suite of packages. If you have not installed these previously, they can be installed using the following command:

```{r install packages, eval=FALSE}
install.packages(c('rstatix','tidyverse'))
```

The packages installation wizard in RStudio can also be used by clicking the Packages tab in the bottom right panel and then clicking Install in the panel's control bar.

### Loading Packages

Packages that are installed are not immediately available to use at all times. In order to directly access a package's commands, it needs to be loaded into the environment using the `library` command.

When working with the tidyverse, it's almost always better to load the `tidyverse` last to try and avoid function name conflicts within the tidyverse packages.

```{r load packages, results='hide', message=FALSE}
library(rstatix)
library(tidyverse)
```


## Loading Data

For the workshop, the data we will be using are stored in basic CSV files. We can use the `read_csv` function to load these data and store them in variables. CSV files can either stored locally or can be referenced using a URL.

```{r load data, results='hide', message=FALSE}
# read in tuition cost over time
cost_attendance <- readr::read_csv('https://raw.githubusercontent.com/mdefende/2022_Intro_to_R_Workshop/main/cleaned_data/cost_of_attendance.csv')

# read in graduation rate data over time
grad_rate <- readr::read_csv('https://raw.githubusercontent.com/mdefende/2022_Intro_to_R_Workshop/main/cleaned_data/graduation_rate.csv')
```

```{r, echo=TRUE}
print(cost_attendance)
```


These data look at how tuition and total cost of attending college in the United State have changed over time. There are also data on graduation rate included for investigating possible correlations of graduation rate and tuition cost. All data come from [TuitionTracker.org](TuitionTracker.org). The variables in each table are explained below:

### Tuition Cost

- `name` (character): The whole name of the college
- `state_code` (character): The two letter abbreviation for the state
- `control` (character): Is the college Private, Public, or For-Profit
- `level` (character): Ideal amount of time to receive the main degree type of the college. Either 2 Year or 4 Year
- `cost_type` (character): What kind of cost is being presented in that row. Either Tuition (plus associated fees) or Total. Total includes tuition as well as costs for a meal plan, textbooks, housing, etc. that are listed on a college's estimated costs.
- `in_state` (character): Are the costs in the row for in-state or out-of state students.
- `AY2009` through `AY2017` (numeric): Cost to attend the college for whole academic years 2009 through 2017. Academic years begin in the fall of the year listed and extend to spring of the following year. For example, AY2009 shows cost to attend in both Fall 2009 and Spring 2010 combined.

### Graduation Rate

- `unit_id` (numeric): a unique identification code given to each college on the [Tuition Tracker](TuitionTracker.org) site.
- `name` and `state_code` are same as above
- `AY2011` through `AY2016` are the same as above.


## Basic Look at Data

While we have a data dictionary that tells us what each variable is in the data frame, it's always good to get a broad look at how the data are structured after they've been loaded. To do this, we can use the `glimpse` function:

```{r glimpse}
glimpse(cost_attendance)
```


## Cost of Tuition in Alabama

Using the datasets available, there are a few questions we can ask about how tuition has changed over time, especially as it relates to both the location, economic model, and main degree type of the college.

### Summary Statistics

**1. In Alabama, what was the average cost of tuition for each type of college (private, public, for-profit) in 2017-2018?**

Here, we will use three functions from `dplyr`, the main data wrangling package in the `tidyverse`. We will be using:

- `filter` to keep data that matches specific criteria
- `group_by` with `summarize` to calculate some summary statistics within specific groups

```{r average AL tuition by group no pipes}
# Filter the main data, keeping those with 'AL' state_codes, a 'total' cost_type, and 'in'-state costs.
cost_AL <- filter(cost_attendance, state_code == 'AL', cost_type == 'total', in_state == 'in')

# group by type of institutional control so that any summary statistics will be split across Public, Private, and For Profit Universities.
cost_AL_grouped <- group_by(cost_AL,control)

# calculate mean, standard deviation, and number of institutions within the groups defined above
summarize(cost_AL_grouped, AY2017_mean = mean(AY2017), AY2017_sd = sd(AY2017), n = n())
```

This was a fairly simple task, just wanting to see the average in-state cost for college in 2017-2018 in Alabama. However, it took 3 separate commands and the creation of two extra variables to get there which isn't very efficient. Instead, we can use the `%>%` operator, a part of the `magrittr` package and the `tidyverse`. It will take the output of the command immediately preceding it and insert the output as the input for the command immediately following it.

So we can write the previous block of code like this instead:

```{r average AL tuition by group with pipes}
cost_attendance %>%
  filter(state_code == 'AL', cost_type == 'total', in_state == 'in') %>%
  group_by(control) %>%
  summarize(AY2017_mean = mean(AY2017), 
            AY2017_sd = sd(AY2017), 
            n = n())
```

In this case, we were able to start with the main dataframe, perform our filtering, group by control type, and calculate out summary statistics without needing to create extra variables or execute three separate commands individually.

Overall, it looks like the average cost of attending a public college in Alabama in AY 2017 was a little over $20,000 while private colleges cost more than 1.5x as much. The deviation in total cost is also twice as much for private colleges in Alabama as public colleges. 

### Density Plots

Means and standard deviations only tell us so much though. We can also look at the distribution using `ggplot`, the premier plotting tool in the `tidyverse`.

`ggplot` works by assigning variables from a dataframe to aesthetics that make up a plot. For instance to make a simple density plot from our Alabama tuition data we used earlier:

```{r basic ggplot}
# Density plot of total cost of all colleges in Alabama in AY2017
cost_AL %>%
  ggplot(aes(x = AY2017)) + 
  geom_density()
```

So most of the tuition amounts seem to be concentrated around \$20,000 per year with some in the \$30,000+ range as well. However, this graph doesn't give us a good idea of which type of institution makes up each part of the density graph. We can use a different aesthetic to split the data by a group, the `color` aesthetic:

```{r AL density color}
# Density plot split by public vs. private institution in Alabama
cost_AL %>%
  ggplot(aes(x = AY2017, color = control)) + 
  geom_density()
```

We can see in this graph that there's a pretty even distribution of cost in AY2017 for private institutions compared to public colleges which have a noticeable peak at \$20,000 and a steep drop-off afterwards.

#### Practice: Basic Summary Statistics and Density Plots

1. What was the median total cost to attend college in NY for in-state students in AY2017? Calculate by control type and include the number of colleges in each group in the output
2. Graph a density plot showing the distribution of total costs for AY2017. Split the graphs by control type.

```{r NY stats and graphs, include = FALSE}
cost_NY <- cost_attendance %>%
  filter(state_code == 'NY', cost_type == 'total', in_state == 'in')

cost_NY %>%
  group_by(control) %>%
  summarize(AY2017_mean = mean(AY2017), 
            AY2017_sd = sd(AY2017), 
            n = n())

cost_NY %>%
ggplot(aes(x = AY2017, color = control)) + 
  geom_density()
```


### Pivoting, Mutating, and Change in Tuition Over Time

It's informative to see how total costs to attend college differ based on a college's economic model, however a cross-sectional analysis can only be so informative. Next, we want to see how total costs for college have changed over time from 2009 to 2017.

In order to do this, we will need to do some transformation of our data structure. Ideally, we will want a line and dot graph with academic year on the X axis and cost on the Y axis. ggplot can only assign column variables to aesthetics, so an X axis containing all of the academic year information isn't possible to create without changing how the data is structured. To fix this, we are going to pivot our data into a longer form using the `pivot_longer` function. This will take all of the academic year columns and essentially stack them into two columns, one with the year designation and the other with the cost for that year for that college.

Let's continue to use the AL state information we've been using so far:

```{r pivot AL}
cost_AL_long <- cost_AL %>%
  pivot_longer(cols = contains('AY'),
               names_to = 'acad_year',
               values_to = 'cost')

head(cost_AL_long)
```



